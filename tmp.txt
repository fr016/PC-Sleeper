#requires -Version 5.1
#requires -Modules ActiveDirectory, DnsClient

<##
.SYNOPSIS
Verifie que les enregistrements DNS d'un domaine correspondent aux adresses IP des controleurs de domaine dans un groupe AD et s'assure qu'un nombre minimum de controleurs de domaine est present.

.DESCRIPTION
Ce script recupere les enregistrements DNS d'un domaine specifie et les compare aux adresses IP des controleurs de domaine membres d'un groupe Active Directory donne. Il verifie egalement que le nombre de controleurs de domaine est superieur ou egal a un seuil defini. Les resultats de la verification sont affiches et un rapport HTML est genere.

.PARAMETER DomainName
Nom du domaine a verifier.

.PARAMETER GroupName
Nom du groupe Active Directory contenant les controleurs de domaine.

.PARAMETER MinimumDcCount
Nombre minimum de controleurs de domaine requis dans le groupe (defaut: 10).

.EXAMPLE
.\Verifier-DnsDcCorrespondance.ps1 -DomainName "example.com" -GroupName "GroupeDC"

.NOTES
Auteur: Votre Nom
Date: 2025-03-06
#>
param (
    [Parameter(Mandatory = $true)]
    [string]$DomainName,

    [Parameter(Mandatory = $true)]
    [string]$GroupName,

    [int]$MinimumDcCount = 10
)

$reportPath = "$env:TMP\Verification_Report.html"
$reportEntries = @()

function Add-ToReport {
    param (
        [string]$Message,
        [string]$Color = "black"
    )
    $script:reportEntries += "<p style='color:$Color;'>$Message</p>"
}

function Generate-Report {
    $reportContent = "<html><head><title>Rapport de verification DNS</title></head><body>"
    $reportContent += "<h2>Verification des enregistrements DNS pour $DomainName</h2>"
    $reportContent += ($reportEntries -join "")
    $reportContent += "</body></html>"
    $reportContent | Out-File -FilePath $reportPath -Encoding UTF8
    Start-Process $reportPath
}

Write-Host "Debut de la verification des enregistrements DNS pour le domaine $DomainName."
Add-ToReport -Message "Debut de la verification des enregistrements DNS pour le domaine $DomainName."

$dcInfo = Get-DomainControllerIPs -GroupName $GroupName
$dcIPs = $dcInfo.IP

Compare-DnsAndDcIPs -DnsIPs (Get-DnsARecords -DomainName $DomainName) -DcIPs $dcIPs

Generate-Report
