
Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object { $_.Extensions | Where-Object { $_.Oid.FriendlyName -eq "Enhanced Key Usage" -and $_.Format(0) -eq "1.3.6.1.5.5.7.3.1" } }


function Test-ServiceCertificate {
    param (
        [string]$Thumbprint
    )

    $cert = Get-ChildItem -Path Cert:\LocalMachine\My | Where-Object { $_.Thumbprint -eq $Thumbprint }
    
    if ($cert -eq $null) {
        Write-Host "Certificat introuvable avec la thumbprint $Thumbprint."
    } else {
        $eku = $cert.Extensions | Where-Object { $_.Oid.FriendlyName -eq "Enhanced Key Usage" }
        if ($eku -ne $null -and $eku.Format(0) -eq "1.3.6.1.5.5.7.3.1") {
            Write-Host "Le certificat avec la thumbprint $Thumbprint est un certificat de service."
        } else {
            Write-Host "Le certificat avec la thumbprint $Thumbprint n'est pas un certificat de service."
        }
    }
}

# Exemple d'utilisation :
# Test-ServiceCertificate -Thumbprint "YOUR_THUMBPRINT"
